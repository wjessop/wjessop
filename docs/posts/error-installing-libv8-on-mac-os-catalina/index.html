<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="/sass/styles.css">
		<script defer data-domain="willj.net" src="https://plausible.io/js/script.js"></script>

		<link href="https://willj.net/rss.xml" rel="alternate" type="application/rss+xml" title="Will Jessop&#39;s Writings" />

		<title>
			Error installing libv8 on Mac OS Catalina
			</title>
		<meta
			name="description"
			content="If you are getting a &#34;fatal error: &#39;climits&#39; file not found&#34; error installing libv8 on Catalina then this post is for you."
		/>
		<meta name="author" content="Will Jessop">
	</head>
	<body>
		<h1>Will Jessop&#39;s Writings</h1>
		<em></srong><p>Sailing, Food, Programming, Technology, and other things</p></em>
		<nav id="nav" class="nav justify-content-center">
	|
<a class="nav-link" href="/">Home</a> |
<a class="nav-link" href="/posts/">Posts</a> |
</nav>


		<time datetime="2020-02-17">Monday, February 17, 2020</time>
	|
	tags:<a href="https://willj.net/tags/ruby">ruby</a> <a href="https://willj.net/tags/macos">MacOS</a> <a href="https://willj.net/tags/tech">tech</a> <a href="https://willj.net/tags/programming">programming</a> 
	<hr />

	<h2>Error installing libv8 on Mac OS Catalina</h2>

	<article>
		<p>I got an error installing the libv8 gem on Catalina:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ gem install libv8 -v <span style="color:#e6db74">&#39;3.16.14.19&#39;</span>
</span></span><span style="display:flex;"><span>Building native extensions.  This could take a <span style="color:#66d9ef">while</span>...
</span></span><span style="display:flex;"><span>ERROR:  Error installing libv8:
</span></span><span style="display:flex;"><span>	ERROR: Failed to build gem native extension.
</span></span><span style="display:flex;"><span>    current directory: /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/ext/libv8
</span></span><span style="display:flex;"><span>/Users/will/.rbenv/versions/2.4.5/bin/ruby -r ./siteconf20200217-34155-18bho1v.rb extconf.rb
</span></span><span style="display:flex;"><span>creating Makefile
</span></span><span style="display:flex;"><span>Applying /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/patches/disable-building-tests.patch
</span></span><span style="display:flex;"><span>Applying /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/patches/disable-werror-on-osx.patch
</span></span><span style="display:flex;"><span>Applying /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/patches/disable-xcode-debugging.patch
</span></span><span style="display:flex;"><span>Applying /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/patches/do-not-imply-vfp3-and-armv7.patch
</span></span><span style="display:flex;"><span>Applying /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/patches/do-not-use-MAP_NORESERVE-on-freebsd.patch
</span></span><span style="display:flex;"><span>Applying /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/patches/do-not-use-vfp2.patch
</span></span><span style="display:flex;"><span>Applying /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/patches/fPIC-for-static.patch
</span></span><span style="display:flex;"><span>Compiling v8 <span style="color:#66d9ef">for</span> x64
</span></span><span style="display:flex;"><span>Using python 2.7.16
</span></span><span style="display:flex;"><span>Using compiler: c++ <span style="color:#f92672">(</span>clang version 11.0.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Unable to find a compiler officially supported by v8.
</span></span><span style="display:flex;"><span>It is recommended to use GCC v4.4 or higher
</span></span><span style="display:flex;"><span>Beginning compilation. This will take some time.
</span></span><span style="display:flex;"><span>Building v8 with env CXX<span style="color:#f92672">=</span>c++ LINK<span style="color:#f92672">=</span>c++  /usr/bin/make x64.release ARFLAGS.target<span style="color:#f92672">=</span>crs werror<span style="color:#f92672">=</span>no
</span></span><span style="display:flex;"><span>GYP_GENERATORS<span style="color:#f92672">=</span>make <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	build/gyp/gyp --generator-output<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;out&#34;</span> build/all.gyp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	              -Ibuild/standalone.gypi --depth<span style="color:#f92672">=</span>. <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	              -Dv8_target_arch<span style="color:#f92672">=</span>x64 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	              -S.x64  -Dv8_enable_backtrace<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -Dv8_can_use_vfp2_instructions<span style="color:#f92672">=</span>true -Darm_fpu<span style="color:#f92672">=</span>vfpv2 -Dv8_can_use_vfp3_instructions<span style="color:#f92672">=</span>true -Darm_fpu<span style="color:#f92672">=</span>vfpv3 -Dwerror<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>  CXX<span style="color:#f92672">(</span>target<span style="color:#f92672">)</span> /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/vendor/v8/out/x64.release/obj.target/preparser_lib/src/allocation.o
</span></span><span style="display:flex;"><span>warning: include path <span style="color:#66d9ef">for</span> stdlibc++ headers not found; pass <span style="color:#e6db74">&#39;-stdlib=libc++&#39;</span> on the command line to use the libc++ standard library instead <span style="color:#f92672">[</span>-Wstdlibcxx-not-found<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>In file included from ../src/allocation.cc:33:
</span></span><span style="display:flex;"><span>../src/utils.h:33:10: fatal error: <span style="color:#e6db74">&#39;climits&#39;</span> file not found
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span>
</span></span><span style="display:flex;"><span>         ^~~~~~~~~
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> warning and <span style="color:#ae81ff">1</span> error generated.
</span></span><span style="display:flex;"><span>make<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: *** <span style="color:#f92672">[</span>/Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/vendor/v8/out/x64.release/obj.target/preparser_lib/src/allocation.o<span style="color:#f92672">]</span> Error <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>make: *** <span style="color:#f92672">[</span>x64.release<span style="color:#f92672">]</span> Error <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>/Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/ext/libv8/location.rb:36:in <span style="color:#e6db74">`</span>block in verify_installation!<span style="color:#e6db74">&#39;: libv8 did not install properly, expected binary v8 archive &#39;</span>/Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/vendor/v8/out/x64.release/obj.target/tools/gyp/libv8_base.a<span style="color:#e6db74">&#39;to exist, but it was not found (Libv8::Location::Vendor::ArchiveNotFound)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	from /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/ext/libv8/location.rb:35:in `each&#39;</span>
</span></span><span style="display:flex;"><span>	from /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/ext/libv8/location.rb:35:in <span style="color:#e6db74">`</span>verify_installation!<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	from /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19/ext/libv8/location.rb:26:in `install!&#39;</span>
</span></span><span style="display:flex;"><span>	from extconf.rb:7:in <span style="color:#e6db74">`</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>extconf failed, exit code <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Gem files will remain installed in /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/gems/libv8-3.16.14.19 <span style="color:#66d9ef">for</span> inspection.
</span></span><span style="display:flex;"><span>Results logged to /Users/will/.rbenv/versions/2.4.5/lib/ruby/gems/2.4.0/extensions/x86_64-darwin-19/2.4.0/libv8-3.16.14.19/gem_make.out
</span></span></code></pre></div><h2 id="the-solution">The Solution</h2>
<p>The solution was as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ brew install v8@3.15
</span></span><span style="display:flex;"><span>$ gem install libv8 -v <span style="color:#e6db74">&#39;3.16.14.19&#39;</span> -- --with-system-v8
</span></span><span style="display:flex;"><span>Building native extensions with: <span style="color:#e6db74">&#39;--with-system-v8&#39;</span>
</span></span><span style="display:flex;"><span>This could take a <span style="color:#66d9ef">while</span>...
</span></span><span style="display:flex;"><span>Successfully installed libv8-3.16.14.19
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> gem installed
</span></span></code></pre></div>
	</article>


		<footer>
	<hr>
	<p>You can find me on <a href="https://github.com/wjessop/">Github</a>, <a rel="me" href="https://ruby.social/@wj">Mastodon</a>, <a href="https://twitter.com/will_j">Twitter</a> (now largely abandoned), and <a href="mailto:will@willj.net">Email</a>.</p>
</footer>

	</body>
</html>
